title: "ALB security group swap"
description: |
  Verify application security configuration.
  Swapping ALB (Application Load Balancer) security groups with a dummy group
  with wide open access policies should stop requests from reaching the target
  application.

contributions:
  security: "high"
  reliability: "low"
  scalability: "low"

controls:
  - name: "xargs"
    provider:
      type: python
      module: chaosxargs.control
    
configuration:
  # use dynamic properties to read values using probes
  dummy_secgroup_arn: null
  original_secgroup_arn: null

method:
  - type: action
    name: "alb-secgroup-swap"
    provider:
      type: python
      module: chaosaws.elbv2.actions
      func: set_security_group
      arguments:
        load_balancer_names:
          # use xargs replace entire list rather than single variable
          - "${alb_name}"
        security_group_ids:
          - "${dummy_secgroup_arn}"

steady-state-hypothesis:
  title: "Ningx web server is available"
  probes:
    - type: probe
      name: "server-must-respond"
      tolerance: 200
      provider:
        type: http
        url: "${service_url}"
        method: "GET"
        timeout: 3

rollbacks:
  - type: action
    name: "alb-secgroup-reset"
    provider:
      type: python
      module: chaosaws.elbv2.actions
      func: set_security_group
      arguments:
        load_balancer_names:
          - "${alb_name}"
        security_group_ids:
          - "${original_secgroup_arn}"
